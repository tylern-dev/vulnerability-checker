import { useState } from 'react'
import { Typography, Box, Accordion, AccordionSummary, AccordionDetails, Skeleton } from "@mui/material"
import {ExpandMore} from '@mui/icons-material'
import request from '../api'
const BreachDetails = ({breach}) => {
  const [breachDetails, setBreachDetails] = useState({})

  const fetchBreachDetails = async (id) => {
    const response = await request({ route: `/exposure-details?id=${id}`})

    const details = {
      [id]: {...response?.result}
    }
    setBreachDetails((prev) => ({...prev, ...details}))
  }

  return (
    <Accordion >
      <AccordionSummary
        expandIcon={<ExpandMore />} 
        id={breach.id}
        onClick={() =>{
          if(!breachDetails[breach.id]){
            fetchBreachDetails(breach.id)
          }
          }}
      >
        <Typography>{breach.title}</Typography>
      </AccordionSummary>
        {Object.keys(breachDetails[breach.id] || {}).length === 0 ?
          <Box sx={{width: 360}}> 
            <Skeleton animation='wave'/>
            <Skeleton animation='wave'/>
            <Skeleton animation='wave'/>
          </Box> :
          <AccordionDetails>
            
            <Typography>
              Category: {breachDetails[breach.id]?.category}
            </Typography>
            <Typography>
              Exposed Data: {breachDetails[breach.id]?.exposedData?.join(', ')}
            </Typography>
            <Typography>
              Password Type: {breachDetails[breach.id]?.passwordType}
            </Typography>
          </AccordionDetails>
        }
    </Accordion>
  )
}

export default BreachDetails