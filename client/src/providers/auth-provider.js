import { useState, useEffect, useContext, createContext } from 'react'
import { useNavigate } from 'react-router-dom'
const AuthContext = createContext()

const AuthContextProvider = ({children}) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false)
  const [apiCredentials, setApiCredentials] = useState({})

  const navigate = useNavigate()
  
  const handleLogin = ({apiKey, apiSecret}) => { 
    if(apiKey && apiSecret) {
      setApiCredentials({
        apiKey,
        apiSecret
      })
      // TODO: look at this
      localStorage.setItem('')
      setIsAuthenticated(true)
      navigate('/dashboard', {replace: true})
    }
    else {
      return new Error('Please provide api key and secret.')
    }
  }

  const handleLogout = () => {
    setIsAuthenticated(false)
    navigate('/')
  }

  // TODO: check this
  // useEffect(() => {
  //   if(Object.keys(apiCredentials).length === 0){
  //     navigate('/')
  //   }
  // },[apiCredentials])


  return (
    <AuthContext.Provider value={{isAuthenticated, apiCredentials, handleLogin, handleLogout}}>
      {children}
    </AuthContext.Provider>
  )
}

const useAuthContext = () => {
  const context = useContext(AuthContext)
  return context
}

export { AuthContextProvider, useAuthContext }