import { useState } from 'react'
import { Input, Typography, Box, Button, Alert } from "@mui/material"
import { Controller, useForm } from 'react-hook-form'
import request from '../api'
const CheckPassword = () => {
  const [isPasswordVulnerable, setIsPasswordVulnerable] = useState(null)
  const [hasFetched, setHasFetched] = useState(false)
  const [error, setError] = useState('')
  const { control, handleSubmit } = useForm({
    defaultValues: {
      password: '',
    }
  })
  const handleOnSubmit = async (data) => {
    setError('')
    const password = data?.password
    try{
      const response = await request({ route: `/check-password?password=${password}` })
      setHasFetched(true)
      setIsPasswordVulnerable(response?.status)

    } catch(e){ 
      setError(e.message) 
    }

  }

  return (
    <Box>
      <Typography component='h1' variant='h5' >Check Password</Typography>
      <Box>
        <Typography>Use the form to check and see if you password has been compromised in any known security breaches.</Typography>
        <Box
          component='form'
          onSubmit={handleSubmit(handleOnSubmit)}
          sx={{
            mt: 8,
            display: 'flex',
            justifyContent: 'center'
          }}
        >
          <Controller
            name="password"
            control={control}
            render={({ field }) => <Input placeholder="Enter Password" type="password" {...field} />}
          />
          <Button type='submit'>Check</Button>
        </Box>
        {error && <Alert severity="error">{error}</Alert>}
        {hasFetched && !error && (
          <Typography align='center' sx={{ color: isPasswordVulnerable ? 'red' : 'green', mt: 2 }}>
            {isPasswordVulnerable ? 'Your password was found in security leaks. Consider changing this password.' : 'This password was not found in our database of known leaks.'}
          </Typography>
        )}
      </Box>

    </Box>
  )

}

export default CheckPassword